[!docker] skip 'docker not available'

# S1: issue flow reliability (solve issue -> deterministic code change artifacts)

mkdir work
mkdir out
mkdir input
mkdir input/context

exec git -C work init
exec git -C work config user.email "test@example.com"
exec git -C work config user.name "Test User"
exec git -C work add main.go
exec git -C work commit -m 'initial commit'

env GITHUB_TOKEN=dummy-token
env HOLON_CLAUDE_DRIVER=mock
env HOLON_CLAUDE_MOCK_FIXTURE=/input/context/fixture.json
exec sh -c 'AGENT="${HOLON_TEST_AGENT_BUNDLE:-default}"; holon solve https://github.com/test/repo/issues/123 --workspace work --input input --output out --image golang:1.22 --agent "$AGENT" --cleanup none'

exists out/manifest.json
exists out/diff.patch
exists out/summary.md

exec grep -q '"status": "completed"' out/manifest.json
exec grep -q '"outcome": "success"' out/manifest.json
exec grep -q 'log.Fatalf' out/diff.patch
exec grep -q 'error handling' out/summary.md

-- work/main.go --
package main

import "fmt"

func main() {
    fmt.Println("Hello, World!")
}

-- input/context/fixture.json --
{
  "version": "v1",
  "description": "Add error handling to main function",
  "operations": [
    {
      "type": "write_file",
      "path": "main.go",
      "content": "package main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n)\n\nfunc main() {\n\tif err := run(); err != nil {\n\t\tlog.Fatalf(\"Error: %v\", err)\n\t}\n}\n\nfunc run() error {\n\tfmt.Println(\"Hello, World!\")\n\treturn nil\n}\n"
    }
  ],
  "outcome": {
    "success": true,
    "result_text": "Added error handling to main function",
    "summary": "# Summary\n\nAdded proper error handling to the main function.\n\n## Changes\n\n- Created `run()` function that returns error\n- Added error logging in main\n- All function calls now properly handle errors"
  }
}
